---
import { Icon } from "astro-icon/components";
import { announcementConfig } from "../../config";
import I18nKey from "../../i18n/i18nKey";
import { i18n } from "../../i18n/translation";
import WidgetLayout from "./WidgetLayout.astro";

const config = announcementConfig;

interface Props {
	class?: string;
	style?: string;
}
const className = Astro.props.class;
const style = Astro.props.style;
---

<!-- 修改点 1: 在 class:list 中添加 "!p-0" 以强制移除默认内边距 -->
<WidgetLayout 
    id="announcement"
    class:list={[className, "!p-0"]} 
    style={style}
>
    <!-- 修改点 2: 添加 flex 布局让内部元素垂直居中，并添加 py-2 稍微留点上下空隙以免字贴着边太难看(如果完全不要空隙可去掉 py-2) -->
    <div class="flex flex-col items-center justify-center w-full py-2">
        
        <!-- 修改点 3: 添加 text-center 让文字居中，添加 px-2 防止文字太长贴到左右边缘 -->
        <div class="text-neutral-600 dark:text-neutral-300 leading-relaxed mb-2 text-center px-2 font-semibold">
            {config.content}
        </div>
        
        <!-- 修改点 4: 将 justify-between 改为 justify-center，让按钮也居中 -->
        <div class="flex items-center justify-center gap-3 w-full">
            <div>
                {config.link && config.link.enable !== false && (
                    <a 
                        href={config.link.url} 
                        target={config.link.external ? "_blank" : "_self"}
                        rel={config.link.external ? "noopener noreferrer" : undefined}
                        class="btn-regular rounded-lg px-3 py-1.5 text-sm font-medium active:scale-95 transition-transform"
                    >
                        {config.link.text}

                    </a>
                )}
            </div>
            
            {config.closable && (
                <button 
                    class="btn-regular rounded-lg h-8 w-8 text-sm hover:bg-red-100 dark:hover:bg-red-900/30 transition-colors"
                    onclick="closeAnnouncement()"
                    aria-label={i18n(I18nKey.announcementClose)}
                >
                    <Icon name="fa6-solid:xmark" class="text-sm" />
                </button>
            )}
        </div>
    </div>
</WidgetLayout>

<script>
    function closeAnnouncement() {
        const widgetLayout = document.querySelector('widget-layout[data-id="announcement"]') as HTMLElement;
        if (widgetLayout) {
            widgetLayout.style.display = 'none';
            localStorage.setItem('announcementClosed', 'true');
        }
    }

    document.addEventListener('DOMContentLoaded', function() {
        const widgetLayout = document.querySelector('widget-layout[data-id="announcement"]') as HTMLElement;
        if (widgetLayout && localStorage.getItem('announcementClosed') === 'true') {
            widgetLayout.style.display = 'none';
        }
    });

    window.closeAnnouncement = closeAnnouncement;
</script>
